---
title: "Homework 5"
subtitle: "Prof: Luiz Peternelli"
author: "Marco Guerra Hinostroza"
date: "`r Sys.Date()`"
format:
  html:
    embed-resources: true
    toc: true
    toc-location: left
    number-sections: false
    code-fold: false
    filters:
        - highlight-text
editor_options: 
  chunk_output_type: console
---

## Question 2

#### Probability density function:

$$
f(x, y, z) = 
\begin{cases}
k(x + y + z) \quad ; \quad 0 \le x \le 1 \quad 0 \le y \le 1 \quad 0 \le z \le 1\\
0 \quad ; \quad c.c
\end{cases}
$$

Since the area under the curve is different from 1
$$
 \int_0^1 \int_0^1 \int_0^1 k(x+y+z) \, dz\,dy\,dx = 1
$$

Integrando en relación a z
$$
\int_0^1 k(x+y+z) \, dz = k\int_0^1 (x+y+z) \, dz =
$$

$$
 k \left[ (x+y)z + \frac{z^2}{2} \right]^1_0 = k\left[ x+y + \frac{1}{2} \right]
$$

Integrando en relación a y

$$
\int_0^1 k\left[ x+y + \frac{1}{2} \right] \, dy = k\int_0^1 \left[ x+y + \frac{1}{2} \right] \, dy =
$$

$$
 k \left[ xy + \frac{y^2}{2} + \frac{y}{2} \right]^1_0 = k\left[ x+ \frac{1}{2} + \frac{1}{2} \right] = k(x+1)
$$

Integrando en relación a x

$$
\int_0^1 k(x+1)\, dx = k\int_0^1(x+1)\, dx = k \left[ \frac{x^2}{2} + x  \right]^1_0 = k \left[ \frac{1}{2} + 1  \right] = k \times \frac{3}{2}
$$

Agora, fazemos essa integral igual a 1:

$$
k \times \frac{3}{2} = 1 \Rightarrow k = \frac{2}{3}
$$

#### f.d.p marginal de X

$$
 f(x) = \int_0^1 \int_0^1  f(x+y+z) \, dz\,dy \, =  \, \int_0^1 \int_0^1  \frac{2}{3}(x+y+z) \, dz\,dy
$$

Integramos em relação a z no intervalo [0,1]:

$$
\frac{2}{3}\int_0^1(x+y+z) \, dz = \frac{2}{3} \left[ (x+y)z + \frac{z^2}{2}  \right]^1_0 = \frac{2}{3} \left[ x+y + \frac{1}{2}  \right]
$$

Integramos em relação a y no intervalo [0,1]:

$$
\frac{2}{3}\int_0^1(x+y+ \frac{2}{3}) \, dy = \frac{2}{3} \left[ xy + \frac{y^2}{2} + \frac{y}{2} \right]^1_0 = \frac{2}{3}(x+1)
$$

A f.d.p. marginal de X é:

$$
f(x) = \frac{2}{3}(x+1), \quad 0 \le x \le 1
$$

#### f(x , y)

$$
f(x,y) = \int_0^1f(x,y,z)\, dz = \frac{2}{3}\int_0^1(x+y+z)dz =
$$


$$
\frac{2}{3}\left[ (x+y)z + \frac{z^2}{2} \right]^1_0 = \frac{2}{3}\left[x + y + \frac{1}{2} \right]
$$

$$
f(x,y) = \frac{2}{3}(x + y + \frac{1}{2})
$$


#### f(y | x)

$$
f(y|x) = \frac{f(x,y)}{f(x)}
$$

$$
f(y|x) = \frac{\frac{2}{3}(x+y+ \frac{1}{2})}{\frac{2}{3}(x+1)} = \frac{x+y+\frac{1}{2}}{x+1}
$$

#### f(z | x,y)

$$
f(z|x,y) = \frac{f(x,y,z)}{f(x,y)}
$$

$$
f(y|x) = \frac{\frac{2}{3}(x+y+z)}{\frac{2}{3}(x+y+\frac{1}{2})} = \frac{x+y+z}{x+y+\frac{1}{2}}
$$

#### Distribucao acumulada F(x)

$$
F(x) = P(X \le x) = \int_0^x f(t)\, dt
$$

$$
F(x) = \int_0^x \frac{2}{3}(t+1)\,dt = \frac{2}{3} \left[ \frac{t^2}{2} + t \right]_0^x = \frac{2}{3} \left[ \frac{x^2}{2} + x  \right]
$$

$$
F(x) = \frac{1}{3}x^2 + \frac{2}{3}x
$$


#### F(y | x)

$$
F(y|x) = P(Y \le y \, | \,  X=x) = \int_0^y f(t|x)\, dt
$$

$$
F(y|x) = \int_0^y \frac{x+t+\frac{1}{2}}{x+1}\,dt =  \frac{1}{x+1} \int_0^y (x + t + \frac{1}{2})\,dt = 
$$

$$
\frac{1}{x+1} \left[ xt + \frac{t^2}{2} + \frac{t}{2} \right]^y_0 = \frac{1}{x+1} \left[ xy + \frac{y^2}{2} + \frac{y}{2} \right]
$$

$$
F(y|x) = \frac{xy + \frac{y^2}{2} + \frac{y}{2}}{x+1}
$$

#### F(z | x,y)

$$
F(z|x,y) = P(Z \le z \, | \,  X=x, Y=y) = \int_0^z f(t|x,y)\, dt
$$

$$
F(z|x,y) = \int_0^z \frac{x+y+t}{x+y+ \frac{1}{2}}\,dt =  \frac{1}{x+y + \frac{1}{2}} \int_0^z (x + y + t)\,dt = 
$$

$$
\frac{1}{x+y + \frac{1}{2}} \left[ (x+y)t + \frac{t^2}{2} \right]^z_0 = \frac{1}{x+y + \frac{1}{2}} \left[ (x+y)z + \frac{z^2}{2} \right]
$$

$$
F(z|x,y) = \frac{(x+y)z + \frac{z^2}{2}}{x +y + \frac{1}{2}}
$$


## Question 4
```{r}
X <- c(10, 20, 30, 40, 50)
p_X <- c(0.10, 0.45, 0.30, 0.10, 0.05)

plot(X, p_X, type="h", main = "Probability distribution",
     xlab="Random Variable X",ylab="Probability P(X=x)",
     font=1,font.lab=1, lwd = 2, ylim = c(0, 0.47))
```

```{r}
data <- rep(X, times = p_X * 100)

hist(data, breaks = c(5, 15, 25, 35, 45, 55), ylim = c(0, 0.05),
     freq = FALSE, col = "#4682B4", border = "black",
     main = "Histogram of probabilities",
     xlab = "Random Variable X", ylab = "Probability")
axis(1, at = seq(5, 55, by = 5), labels = seq(5, 55, by = 5))

```

## Question 6

```{r}
corr<-rbind(c(   1,  .8, -.03),
            c(  .8,   1,  .04),
            c( -.03, .04,   1))

variances <- c(1, 16, 1)

# Criando a matriz de covariância
sigma <- diag(sqrt(variances)) %*% corr %*% diag(sqrt(variances))

# Exibindo a matriz de covariância
sigma
```

```{r}
gera.mult.chol <- function(v.medias, sigma, iteracoes) {
  mu <- v.medias 
  fc <- chol(sigma[1:2, 1:2]) 
  iter <- iteracoes
  p <- length(fc[1, ]) 
  variaveis <- matrix(NA, iter, 3)

  for (i in 1:iter) {
    
    x <- 3 * runif(1)^2
    
    y <- rnorm(1)
    
    z <- sample(1:4, size = 1, replace = TRUE, prob = c(0.1, 0.2, 0.3, 0.4))
    
    # Standardize X and Y
    x_std <- x - mu[1]
    y_std <- y - mu[2]
    
    transformed <- c(x_std, y_std) %*% t(fc)
    
    variaveis[i, ] <- c(transformed, z) + c(mu[1:2], 0)
  }
  
  return(variaveis)
}
```

Define the parameters:
```{r}
# Define the parameters
u <- c(1.5, 10, 2.5) # Adjusted means for X, Y, and Z
sigma <- matrix(c(1, 0.5, -0.03,
                  0.5, 16, 0.05,
                 -0.03, 0.05, 1), ncol = 3) # Covariance matrix
```


```{r}
set.seed(123)
j <- gera.mult.chol(v.medias = u, sigma = sigma, iteracoes = 1000)
```

:::: {.columns}

::: {.column width="40%"}
Target Covariance Matrix
```{r}
sigma
```
:::

::: {.column width="2%"}
:::

::: {.column width="58%"}
Empirical Covariance Matrix
```{r}
cov(j)
```
:::

::::

```{r}
plot(density(j[,1]))
hist(j[,1],prob=T,add=T)
boxplot(j[,1])

#fazendo o hist para a variável 3
max_density <- 1 / (sqrt(2 * pi * sigma[3, 3]))
hist(j[,3],prob=T, ylim = c(0, max_density * 1.2))
curve(dnorm(x,mean = 2.5, sd =sqrt(sigma[3,3])),add=T, col = "blue")

# melhor visualização
library(psych)
summary(j)
var(j)
cor(j,method='pearson')
pairs.panels(j)
```

