---
title: "Homework 5"
subtitle: "Prof: Luiz Peternelli"
author: "Marco Guerra Hinostroza"
date: "`r Sys.Date()`"
format:
  html:
    embed-resources: true
    toc: true
    toc-location: left
    number-sections: false
    code-fold: false
    filters:
        - highlight-text
editor_options: 
  chunk_output_type: console
---

```{r, include=FALSE}
library(psych)
library(ggplot2)
```


## Question 2

#### Probability density function:

$$
f(x, y, z) = 
\begin{cases}
k(x + y + z) \quad ; \quad 0 \le x \le 1 \quad 0 \le y \le 1 \quad 0 \le z \le 1\\
0 \quad ; \quad c.c
\end{cases}
$$

Since the area under the curve is different from 1
$$
b \int_0^1 \int_0^1 \int_0^1 k(x+y+z) \, dz\,dy\,dx = 1
$$

Integrando en relación a z
$$
\int_0^1 k(x+y+z) \, dz = k\int_0^1 (x+y+z) \, dz =
$$

$$
 k \left[ (x+y)z + \frac{z^2}{2} \right]^1_0 = k\left[ x+y + \frac{1}{2} \right]
$$

Integrando en relación a y

$$
\int_0^1 k\left[ x+y + \frac{1}{2} \right] \, dy = k\int_0^1 \left[ x+y + \frac{1}{2} \right] \, dy =
$$

$$
 k \left[ xy + \frac{y^2}{2} + \frac{y}{2} \right]^1_0 = k\left[ x+ \frac{1}{2} + \frac{1}{2} \right] = k(x+1)
$$

Integrando en relación a x

$$
\int_0^1 k(x+1)\, dx = k\int_0^1(x+1)\, dx = k \left[ \frac{x^2}{2} + x  \right]^1_0 = k \left[ \frac{1}{2} + 1  \right] = k \times \frac{3}{2}
$$

Agora, fazemos essa integral igual a 1:

$$
k \times \frac{3}{2} = 1 \Rightarrow k = \frac{2}{3}
$$

#### f.d.p marginal de X

$$
 f(x) = \int_0^1 \int_0^1  f(x+y+z) \, dz\,dy \, =  \, \int_0^1 \int_0^1  \frac{2}{3}(x+y+z) \, dz\,dy
$$

Integramos em relação a z no intervalo [0,1]:

$$
\frac{2}{3}\int_0^1(x+y+z) \, dz = \frac{2}{3} \left[ (x+y)z + \frac{z^2}{2}  \right]^1_0 = \frac{2}{3} \left[ x+y + \frac{1}{2}  \right]
$$

Integramos em relação a y no intervalo [0,1]:

$$
\frac{2}{3}\int_0^1(x+y+ \frac{2}{3}) \, dy = \frac{2}{3} \left[ xy + \frac{y^2}{2} + \frac{y}{2} \right]^1_0 = \frac{2}{3}(x+1)
$$

A f.d.p. marginal de X é:

$$
f(x) = \frac{2}{3}(x+1), \quad 0 \le x \le 1
$$

#### f(x , y)

$$
f(x,y) = \int_0^1f(x,y,z)\, dz = \frac{2}{3}\int_0^1(x+y+z)dz =
$$


$$
\frac{2}{3}\left[ (x+y)z + \frac{z^2}{2} \right]^1_0 = \frac{2}{3}\left[x + y + \frac{1}{2} \right]
$$

$$
f(x,y) = \frac{2}{3}(x + y + \frac{1}{2})
$$


#### f(y | x)

$$
f(y|x) = \frac{f(x,y)}{f(x)}
$$

$$
f(y|x) = \frac{\frac{2}{3}(x+y+ \frac{1}{2})}{\frac{2}{3}(x+1)} = \frac{x+y+\frac{1}{2}}{x+1}
$$

#### f(z | x,y)

$$
f(z|x,y) = \frac{f(x,y,z)}{f(x,y)}
$$

$$
f(y|x) = \frac{\frac{2}{3}(x+y+z)}{\frac{2}{3}(x+y+\frac{1}{2})} = \frac{x+y+z}{x+y+\frac{1}{2}}
$$

#### Distribucao acumulada F(x)

$$
F(x) = P(X \le x) = \int_0^x f(t)\, dt
$$

$$
F(x) = \int_0^x \frac{2}{3}(t+1)\,dt = \frac{2}{3} \left[ \frac{t^2}{2} + t \right]_0^x = \frac{2}{3} \left[ \frac{x^2}{2} + x  \right]
$$

$$
F(x) = \frac{1}{3}x^2 + \frac{2}{3}x
$$


#### F(y | x)

$$
F(y|x) = P(Y \le y \, | \,  X=x) = \int_0^y f(t|x)\, dt
$$

$$
F(y|x) = \int_0^y \frac{x+t+\frac{1}{2}}{x+1}\,dt =  \frac{1}{x+1} \int_0^y (x + t + \frac{1}{2})\,dt = 
$$

$$
\frac{1}{x+1} \left[ xt + \frac{t^2}{2} + \frac{t}{2} \right]^y_0 = \frac{1}{x+1} \left[ xy + \frac{y^2}{2} + \frac{y}{2} \right]
$$

$$
F(y|x) = \frac{xy + \frac{y^2}{2} + \frac{y}{2}}{x+1}
$$

#### F(z | x,y)

$$
F(z|x,y) = P(Z \le z \, | \,  X=x, Y=y) = \int_0^z f(t|x,y)\, dt
$$

$$
F(z|x,y) = \int_0^z \frac{x+y+t}{x+y+ \frac{1}{2}}\,dt =  \frac{1}{x+y + \frac{1}{2}} \int_0^z (x + y + t)\,dt = 
$$

$$
\frac{1}{x+y + \frac{1}{2}} \left[ (x+y)t + \frac{t^2}{2} \right]^z_0 = \frac{1}{x+y + \frac{1}{2}} \left[ (x+y)z + \frac{z^2}{2} \right]
$$

$$
F(z|x,y) = \frac{(x+y)z + \frac{z^2}{2}}{x +y + \frac{1}{2}}
$$


## Question 4
```{r}
X <- c(10, 20, 30, 40, 50)
p_X <- c(0.10, 0.45, 0.30, 0.10, 0.05)

plot(X, p_X, type="h", main = "Probability distribution",
     xlab="Random Variable X",ylab="Probability P(X=x)",
     font=1,font.lab=1, lwd = 2, ylim = c(0, 0.47))
```

```{r}
data <- rep(X, times = p_X * 100)

hist(data, breaks = c(5, 15, 25, 35, 45, 55), ylim = c(0, 0.05),
     freq = FALSE, col = "#4682B4", border = "black",
     main = "Histogram of probabilities",
     xlab = "Random Variable X", ylab = "Probability")
axis(1, at = seq(5, 55, by = 5), labels = seq(5, 55, by = 5))

```

## Question 6


```{r}
gera.mult.chol<-function(v.medias, sigma, iteracoes)
  {
  mu<-v.medias
  fc<-chol(sigma) #matriz da cholesky
  iter<-iteracoes
  p<-length(fc[1,])
  variaveis<-matrix(99,iter,p)
  for (i in 1:iter)
    {
    #gerar o vetor z a partir da distribuicao desejada, de dimencao px1
    z<-rnorm(p) #usando aqui a distribuicao normal(0,1)
    #obter o vetor multivariado, de dimensao px1, fazendo
    variaveis[i,]<-mu+t(fc)%*%z #mu eh um vetor de medias px1
    }
  return(variaveis)
  }
```

Define the parameters:
```{r}
u <- c(1.5, 10, 2.5) # Adjusted means for X, Y, and Z
sigma <- matrix(c(10, 2, 0.3,
                  2, 16, -0.5,
                 0.3, -0.5, 1), ncol = 3) # Covariance matrix
```


```{r}
set.seed(123)
j <- gera.mult.chol(v.medias = u, sigma = sigma, iteracoes = 1000)
cov(j)
```

:::: {.columns}

::: {.column width="40%"}
Target Covariance Matrix
```{r}
sigma
```
:::

::: {.column width="2%"}
:::

::: {.column width="58%"}
Empirical Covariance Matrix
```{r}
cov(j)
```
:::

::::

```{r}
# usar o método da transformação inversa
u1<-pnorm(j[,1])
plot(j[,1],pnorm(j[,1]))
u2<-pnorm(j[,2])

plot(j[,2],pnorm(j[,2]))
u3<-pnorm(j[,3])
plot(j[,3],pnorm(j[,3]))
# obter a matriz de v.a. uniformemente distribuidas
u<-cbind(u1,u2,u3)
head(u)
summary(u)
boxplot(u)
pairs.panels(u)
```

```{r}
#supor as novas variaveis de interesse. Fazer x = F^-1(u)
#exponencial
x1<-qexp(u1)
hist(x1,prob=T)
curve(dexp(x),0,20,add=T,col="blue")
#normal
x2<-qnorm(u2,10,4)
hist(x2,prob=T)
curve(dnorm(x,4,2),-6,15,add=T,col="blue")
#t  
# x3<-qt(u3, df = 5)
# hist(x3,prob=T)
# curve(dt(x,5),-5, 5,add=T,col="blue")
x3<-ifelse(u3<1/3,2,4) #supondo uma v.a.d onde x=2 com prob 1/3 e x=4 com prob 2/3
plot(table(x3)/length(x3))
# x3 <- sqrt(u3)
```

```{r}
breaks <- quantile(j[, 3], probs = c(0, 0.1, 0.3, 0.6, 1)) 

# Transformar os valores contínuos em categorias 1, 2, 3, 4
j[, 3] <- cut(j[, 3], breaks = breaks, labels = 1:4, include.lowest = TRUE)

# Converter para valores numéricos
j[, 3] <- as.numeric(j[, 3])
```

```{r}
j[, 1] <- pnorm(j[,1])

# Aplicar a inversa da CDF para ajustar à distribuição X ~ 3x^2
j[, 1] <- j[, 1]^(1/3)

# Ajustar os valores para o intervalo (0, 3)
j[, 1] <- j[, 1] * 3
```

## Question 10

#### Distribucion x2
A distribuição da estatística qui-quadrado com *k* graus de liberdade é derivada da soma de quadrados de *k*
variáveis normais padrão $[ex.: Z ∼ N(0, 1)]$:

$$
X^2 = Z_1^2 + Z_1^2 + Z_1^2 + ... + Z_1^2 \quad ; X^2 \sim X_k^2
$$

A função padrão utiliza essa propriedade para gerar valores que seguem essa distribuição amostral. Simulando, por exemplo, 10 observações normais padrão:

```{r}
iter<-1000
X<-NULL
for (i in 1:iter)
  {
  k<-10
  z<-rnorm(k)
  X[i]<-sum(z^2)
}
```

Vamos checar se os valores gerados seguem o desejado. Primeiro, verificamos o histograma:

```{r}
ggplot() +
  geom_histogram(aes(x = X, after_stat(density)), color = "black") +
  stat_function(fun = function(x) dchisq(x,k), color = "tomato", linewidth = 1.5) +
  ylab("Density") +
  theme_bw()

```

Também podemos verificar se as estimativas dos parâmetros média e variância seguem o esperado. A esperança da FDP da qui-quadrado é igual ao número de graus de liberdade que deu origem à distribuição, enquanto a variância corresponde à este mesmo número multiplicado por dois.

Mean
```{r}
mean(X)
```

Variance
```{r}
mean(X^2) - mean(X)^2
```


Como tanto $E(X)$ quanto $V(X)$ são próximos do valor esperado (10 e 20, respectivamente), conclui-se que a simulação foi bem sucedida em gerar valores que seguem a distribuição amostral em questão.

Vejamos o que acontece quando simulamos amostras de uma normal não-padrão. Vamos considerar uma média de 10 e uma variância de 8:

```{r}
iter<-1000
X<-NULL
mu = 10
vari = 8
for (i in 1:iter)
  {
  k<-10
  z<-rnorm(k, mean = mu, sd = sqrt(vari))
  X[i]<-sum(z^2)
}
```

Vejamos se os valores seguem o que é esperado:

```{r}
ggplot() +
  geom_histogram(aes(x = X, y = after_stat(density)), color = "black") +
  stat_function(fun = function(x) dchisq(x,k), color = "tomato", linewidth = 1.5) +
  xlim(0, max(X)) +
  ylab("Density") +
  theme_bw()
```

```{r}
mean(X)
```

```{r}
mean(X^2) - mean(X)^2
```

Ao fugir da pressuposição da normalidade-padrão, o protocolo utilizado para simulação não gera valores que seguem a distribuição qui-quadrado. Ainda assim, é possível gerar valores de tal distribuição utilizando observações advindas de normais não-padrão. Para isto, basta padronizar as observações, isto é:

$$
\frac{\sum_{i=1}^k(x_i - \overline{x})}{\sigma^2} \sim X^2_k
$$

```{r}
iter<-1000
X<-NULL
mu = 10
vari = 8
for (i in 1:iter)
  {
  k<-10 
  z<-rnorm(k, mean = mu, sd = sqrt(vari))
  X[i]<-sum((z-mu)^2)/vari
}
```

```{r}
ggplot() +
  geom_histogram(aes(x = X, y = after_stat(density)), color = "black") +
  stat_function(fun = function(x) dchisq(x,k), color = "tomato", linewidth = 1.5) +
  xlim(0, max(X)) +
  ylab("Density") +
  theme_bw()
```

```{r}
mean(X)
```

```{r}
mean(X^2) - mean(X)^2
```

